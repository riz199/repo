<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Text Encryptor/Decryptor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!link href="base.css" rel="stylesheet">
  <style>
  body {
  font-family: 'Inter', Arial, sans-serif;
  background-color: #f9fafb;
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
  font-weight: 600;
}

label {
  font-weight: 500;
  margin-top: 10px;
}


input[type="file"] {
  display: block;
  width: 100%;
  padding: 6px 10px;
  font-size: 0.9rem;
  border-radius: 6px;
  border: 1px solid #ddd;
  cursor: pointer;
  box-sizing: border-box;
}

textarea, input[type="password"], input[type="text"] {
  width: 100%;
  margin: 10px 0;
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 0.95rem;
  box-sizing: border-box;
}

button {
  height: 42px;
  font-size: 0.95rem;
  padding: 0 15px;
  border-radius: 6px;
  border: none;
  background-color: #007bff;
  color: white;
  transition: background-color 0.2s ease-in-out;
  white-space: nowrap;
}

button:hover { background-color: #0056b3; }
button:active { background-color: #004a99; }

.btn-group-custom {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
  margin-bottom: 10px;
}

.small-row {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}

@media (max-width: 420px) {
  button { font-size: 0.8rem; padding: 0 10px; height: 40px; }
  textarea { font-size: 0.85rem; }
}

@media (max-width: 340px) {
  button { font-size: 0.75rem; height: 38px; }
}

/* Toast Notifications */
#toastContainer {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 99999; /* very high to be on top */
  display: flex;
  flex-direction: column;
  gap: 8px;
  pointer-events: none; /* clicks pass through container */
  width: auto;
  max-width: 90%; /* responsive width */
  align-items: center;
}

.toast {
  background-color: #333;
  color: white;
  padding: 10px 15px;
  border-radius: 6px;
  min-width: 200px;
  max-width: 100%;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  font-size: 0.9rem;
  text-align: center;
  opacity: 0;
  transform: translateY(-20px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  pointer-events: auto; /* allow interaction with toast itself */
  word-wrap: break-word;
}

.toast.show {
  opacity: 0.95;
  transform: translateY(0);
}

.toast-success { background-color: #28a745; }
.toast-error { background-color: #dc3545; }
.toast-info { background-color: #17a2b8; }

/* Extra responsiveness for very small devices */
@media (max-width: 360px) {
  .toast {
    font-size: 0.8rem;
    padding: 8px 12px;
    min-width: 150px;
  }
}

/* MODAL CSS IF Removal is Needed */
/* Modern minimal PIN modal */
.pin-modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(6px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  padding: 10px; /* ensure small screens have some padding */
  box-sizing: border-box;
}

.pin-modal-content {
  background: #fff;
  color: #111;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  min-width: 260px;
  max-width: 400px; /* prevent extreme width on large screens */
  width: 100%;      /* responsive width */
  box-sizing: border-box;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

.pin-modal-content h2 {
  margin-bottom: 12px;
  font-size: 1.3rem;
  font-weight: 600;
}

/* Top buttons row */
.pin-top-buttons {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin-bottom: 12px;
}

.pin-top-buttons button {
  padding: 6px 10px;
  font-size: 0.85rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #007bff;
  color: #fff;
  transition: background-color 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.pin-top-buttons button:hover {
  background-color: #0056b3;
}

/* Inputs */
.pin-modal-content input {
  font-size: 1rem;
  padding: 10px 12px;
  width: 100%;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
  text-align: center;
  background: #f8f9fa;
  box-sizing: border-box;
}

/* Unlock button */
.pin-modal-content button#pinSubmit {
  padding: 10px 16px;
  font-size: 1rem;
  border-radius: 6px;
  cursor: pointer;
  background-color: #007bff;
  color: #fff;
  border: none;
  transition: background-color 0.2s ease;
}

.pin-modal-content button#pinSubmit:hover {
  background-color: #0056b3;
}

/* Error message */
#pinError {
  color: #dc3545;
  margin-top: 8px;
  font-size: 0.875rem;
  display: none;
}

/* Responsive tweaks for tiny screens */
@media (max-width: 320px) {
  .pin-modal-content {
    padding: 20px 15px;   /* reduce padding */
    min-width: auto;      /* allow shrinking below 280px */
    width: 90%;           /* occupy almost full screen */
  }

  .pin-modal-content input,
  .pin-modal-content button#pinSubmit {
    font-size: 0.95rem;   /* slightly smaller text */
    padding: 8px 10px;    /* smaller padding */
  }

  .pin-top-buttons button {
    padding: 6px 8px;
    font-size: 0.8rem;
  }
}


/* Unlock button */
.pin-modal-content button#pinSubmit {
  width: 100%;           /* make full width like input */
  padding: 10px 16px;
  font-size: 1rem;
  border-radius: 6px;
  cursor: pointer;
  background-color: #007bff;
  color: #fff;
  border: none;
  transition: background-color 0.2s ease;

  /* Fix text alignment */
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}
/* MODAL CSS IF Removal is Needed */


  </style>
  
	<script>
	const ENCRYPTED_PREFIX = "U2FsdGVkX19wdrvjEXVDQX3H/+KTzTDOLKGhFJXzCyJO2autIvi1CIRnXdzEPHbezbzcxy5No3xcMUzabtJB3fQz1YF8BxfQQjEZPi2UoZg=";
	const ENCRYPTED_POSTFIX = "U2FsdGVkX1/WmMFyo04aeF4q6YEXcTWamEPconzbNG7p2f7/FHdmPmQEYeGHV1oUbEFwkwMcoS9mY7fhurxbwbWy14iEqj7epaCDjmeiAoA=";
	</script>
</head>

<body>
<!-- PIN Modal Remove or diable this block if no Modal is needed -->
<div id="pinModal" class="pin-modal">
  <div class="pin-modal-content">
    <h2>Enter PIN</h2>

    <!-- Buttons on top, centered -->
    <div class="pin-top-buttons">
      <button type="button" id="fetchDropboxBtn">üåê</button>
      <button type="button" id="pinKeyUploadBtn">üìÇ</button>
    </div>

    <!-- Input below buttons -->
    <input type="password" id="pinKeyInput" value="ÍôÆ‚Ç™ÿã‚Ç©‡∏ø‚Ç∫‡ß≥‚∏ò‚ç∞‚åò‚èö‚ß´üÇ°üù∞üúöÍôÆ‚Ç™ÿã‚Ç©‡∏ø‚Ç∫‡ß≥‚∏ò‚ç∞‚åò‚èö‚ß´üÇ°üù∞üúöÍôÆ‚Ç™ÿã‚Ç©‡∏ø‚Ç∫‡ß≥‚∏ò‚ç∞‚åò‚èö‚ß´üÇ°üù∞üúö" placeholder="Paste key or Dropbox link">
    <input type="tel" id="pinInput" placeholder="PIN" maxlength="10" pattern="[0-9]*" inputmode="numeric">
    <button id="pinSubmit">Unlock</button>
    <div id="pinError">Incorrect PIN. Try again.</div>
  </div>
</div>
<!-- PIN Modal Remove or diable this block if no Modal is needed -->


  <h2>üîê Basic Encrypter</h2>

  <label>Upload .txt File:</label>
  <input type="file" id="fileInput" accept=".txt" class="form-control"><br>

  <label>Original Text (paste encrypted Base64 or plaintext):</label>
  <textarea id="originalText" rows="10" placeholder="File content here..."></textarea>

  <label>Password:</label>
  <input type="password" id="aesPassword" placeholder="Enter password">

  <div class="small-row">
    <label style="margin:0;"><input type="checkbox" id="applyPrefix" checked> Apply PREFIX/SUFFIX</label>
    <span style="color:#666; font-size:0.9rem;">(checked = same behavior as before)</span>
  </div>

  <div class="btn-group-custom">
    <button onclick="encryptText()">Encrypt</button>
    <button onclick="decryptText()">Decrypt</button>
  </div>

  <label>Result:</label>
  <textarea id="resultText" rows="10" placeholder="Encrypted/Decrypted text..."></textarea><br>

  <input type="text" id="downloadFilename" placeholder="Enter filename (optional)" style="width:100%; margin:10px 0; padding:10px 12px; border:1px solid #ddd; border-radius:6px; font-size:0.95rem; box-sizing:border-box;">

  <div class="btn-group-custom">
    <button onclick="saveFile()">üíæ Save Result</button>
    <button onclick="copyResult()">üìã Copy Result</button>
  </div>

  <div id="toastContainer"></div>

  <script src="base.js"></script>
  <script>
// Initialize PIN modal
setupPINModal({
    pinInputId: 'pinInput',
    keyInputId: 'pinKeyInput',
    modalId: 'pinModal',
    pinSubmitId: 'pinSubmit',
    errorId: 'pinError',
    autoUnlock: true // automatically verify PIN while typing
});


// Setup file upload button
setupUploadButton('pinKeyUploadBtn', 'pinKeyInput');

// Setup fetch button (optional)
setupFetchButton('fetchDropboxBtn', 'pinKeyInput', showToast);


function getRawPass() {
    const userPass = document.getElementById("aesPassword").value.trim();
    if (!userPass) {
        showToast("Enter password.", "error");
        return null;
    }

    // Only append prefix/postfix if checkbox is checked
    const apply = document.getElementById("applyPrefix").checked;
    let rawPass = userPass;
    if (apply && typeof PREFIXS !== "undefined" && typeof POSTFIXS !== "undefined") {
        rawPass = PREFIXS + userPass + POSTFIXS;
    }

    return rawPass;
}

function encryptText() {
    const rawPass = getRawPass();
    if (!rawPass) return;

    const plaintext = document.getElementById("originalText").value;
    if (!plaintext) {
        showToast("Enter text to encrypt.", "error");
        return;
    }

    try {
        const ciphertext = base.encryptText(plaintext, rawPass, true);
        document.getElementById("resultText").value = ciphertext;
        showToast("Encryption successful!", "success");
    } catch (err) {
        console.error(err);
        showToast("Encryption failed.", "error");
    }
}

function decryptText() {
    const rawPass = getRawPass();
    if (!rawPass) return;

    const ciphertext = document.getElementById("originalText").value;
    if (!ciphertext) {
        showToast("Enter text to decrypt.", "error");
        return;
    }

    try {
        const plaintext = base.decryptText(ciphertext, rawPass, true);
        document.getElementById("resultText").value = plaintext;
        showToast("Decryption successful!", "success");
    } catch (err) {
        console.error(err);
        showToast("Decryption failed. Ensure correct password and OpenSSL format.", "error");
    }
}



</script>
</body>
</html>

