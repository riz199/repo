<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Retriever</title>

  <!-- âœ… Bootstrap 5 -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">


  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
      background-color: #f9fafb;
      color: #333;
    }
    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
	input[type="file"] {
	display: block;
	width: 100%;
	padding: 6px 10px;
	font-size: 0.9rem;
	border-radius: 6px;
	border: 1px solid #ddd;
	cursor: pointer;
	box-sizing: border-box;
	}

    input[type="text"], input[type="password"], select, datalist, textarea {
      font-size: 0.9rem;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px;
    }
    button {
      padding: 6px 10px;
      font-size: 0.9rem;
      margin: 5px 3px 5px 0;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background-color: #007bff;
      color: white;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background-color: #0056b3;
    }

    /* Ensure uniform height for buttons and fields */
    input[type="text"], input[type="password"], button {
      height: 38px !important;
    }

    .link-row,
    .password-row,
    .search-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    #linkInput, #encryptedLinkSelector {
      flex: 1;
      min-width: 180px;
    }

    .result-block {
      border-top: 1px solid #ddd;
      padding: 6px 0 4px;
      margin-top: 6px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .result-block h4 {
      margin: 4px 0 8px;
      font-size: 1rem;
      font-weight: 600;
    }

    .field-row {
      display: flex;
      align-items: center;
      margin: 2px 0;
      flex-wrap: wrap;
    }

    .field-row label {
      flex: 1;
      font-weight: 500;
      font-size: 0.85rem;
      margin-right: 6px;
      white-space: nowrap;
    }

    .field-row input {
      flex: 2;
      font-size: 0.85rem;
      padding: 4px;
      box-sizing: border-box;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .field-row button.copy-btn {
      flex-shrink: 0;
      margin-left: 6px;
      font-size: 0.85rem;
      padding: 4px 8px;
      background-color: #6c757d;
    }

    .field-row button.copy-btn:hover {
      background-color: #5a6268;
    }

    textarea {
      width: 100%;
      height: 200px;
      margin-top: 20px;
      font-size: 0.9rem;
      display: none;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background: #fff;
      padding: 10px;
    }

    #textarea1-buttons,
    #textarea2-buttons {
      display: none;
      gap: 10px;
      margin-top: 6px;
      flex-wrap: nowrap;
    }

    hr {
      margin: 1.5rem 0;
    }

    label {
      font-weight: 500;
      margin-top: 0.5rem;
      display: block;
    }

    @media (max-width: 576px) {
      body {
        padding: 10px;
      }
      h2 {
        font-size: 1.4rem;
      }
      button {
        width: 100%;
      }
      .link-row,
      .password-row,
      .search-row {
        flex-direction: column;
        align-items: stretch;
      }
    }
	
@media (max-width: 420px) {
  /* Ensure inputs remain usable but smaller */
  input[type="text"], input[type="password"], .form-control {
    font-size: 0.82rem !important;
    padding: 6px !important;
  }

  /* Reduce button font and padding but keep height 38px exactly */
  button {
    font-size: 0.78rem !important;
    padding: 4px 8px !important;
    height: 38px !important; /* keep strict same height */
    line-height: 1 !important;
    min-width: 0 !important;    /* allow shrinking */
    max-width: 100%;            /* do not overflow container */
    box-sizing: border-box !important;
    white-space: nowrap !important;      /* single line */
    overflow: hidden !important;         /* hide overflow */
    text-overflow: ellipsis !important;  /* show ellipsis when needed */
  }

  /* Make the big action buttons (that contain emoji + long text) behave better:
     limit their max width so they don't push other elements */
  #textarea1-buttons button,
  #textarea2-buttons button,
  .password-row > button,
  .search-row > button {
    max-width: 220px !important; /* safe cap for tiny screens */
  }

  /* Copy buttons inside field-row (short labels) should be compact */
  .field-row button.copy-btn {
    padding: 4px 6px !important;
    font-size: 0.78rem !important;
    margin-left: 6px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    height: 38px !important;
  }

  /* If a button is in a stacked (column) layout, let it be full width but still clipped */
  .link-row, .password-row, .search-row {
    gap: 8px;
  }

  /* Slightly tighten headings to save vertical space on tiny screens */
  .result-block h4 { font-size: 0.95rem; }
}

/* Toast Notifications */
#toastContainer {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 99999; /* very high to be on top */
  display: flex;
  flex-direction: column;
  gap: 8px;
  pointer-events: none; /* clicks pass through container */
  width: auto;
  max-width: 90%; /* responsive width */
  align-items: center;
}

.toast {
  background-color: #333;
  color: white;
  padding: 10px 15px;
  border-radius: 6px;
  min-width: 200px;
  max-width: 100%;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  font-size: 0.9rem;
  text-align: center;
  opacity: 0;
  transform: translateY(-20px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  pointer-events: auto; /* allow interaction with toast itself */
  word-wrap: break-word;
}

.toast.show {
  opacity: 0.95;
  transform: translateY(0);
}

.toast-success { background-color: #28a745; }
.toast-error { background-color: #dc3545; }
.toast-info { background-color: #17a2b8; }

/* Extra responsiveness for very small devices */
@media (max-width: 360px) {
  .toast {
    font-size: 0.8rem;
    padding: 8px 12px;
    min-width: 150px;
  }
}

/* Modernized search result cards */
.result-card {
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  background-color: #ffffff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  margin-bottom: 10px;
  padding: 10px 14px;
  transition: box-shadow 0.2s ease-in-out;
}
.result-card:hover {
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}
.result-card h5 {
  font-size: 1rem;
  font-weight: 600;
  color: #007bff;
  margin-bottom: 6px;
}
.result-field {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  margin-bottom: 6px;
}
.result-field input {
  flex: 1;
  min-width: 200px;
  background-color: #f8f9fa;
  border: none;
  font-size: 0.9rem;
  padding: 6px 8px;
  border-radius: 6px;
}
.result-field button {
  margin-left: 8px;
  font-size: 0.85rem;
}

@media (max-width: 576px) {
  .d-flex.flex-wrap.gap-2 > button {
    flex: 1 1 100%;
    width: 100%;
    text-align: center;
  }
}

#decomWrapper {
  display: inline-flex;
  align-items: center;
  margin-left: 8px;
}

#decomWrapper .form-check-input {
  height: 34px;
  width: 60px;
  margin-top: 0;
}

#decomWrapper .form-check-label {
  margin-left: 6px;
  font-weight: 500;
  font-size: 0.9rem;
}


  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>

<body>
  <h2>Retriever</h2>

  <label>Upload File (.txt):</label>
  <input type="file" id="fileInput" accept=".txt" class="form-control mb-2">

  <label>Paste Link:</label>
  <div class="link-row">
    <input type="text" id="linkInput" placeholder="Paste link here..." class="form-control" />
    <input list="encryptedLinks" id="encryptedLinkSelector" placeholder="Or select predefined" class="form-control" />
    <datalist id="encryptedLinks">
      <option value="john"></option>
      <option value="paul"></option>
	  <option value="Ri"></option>
    </datalist>
  </div>

  <label>AES Decryption Password and Load:</label>
<div class="password-row">
  <input type="password" id="aesPassword" placeholder="Enter AES password" class="form-control">
  <button id="loadEncryptedBtn" onclick="loadEncryptedData()">ðŸ”“ Load Encrypted Data</button>
  <button id="resetBtn" onclick="resetAll()" style="display:none;background-color:#dc3545;color:white;">ðŸ”„ Reset</button>
  <div class="form-check form-switch" id="decomWrapper" style="display:none; margin-left:10px;">
    <input class="form-check-input" type="checkbox" id="decomCheckbox">
    <label class="form-check-label" for="decomCheckbox">Decom</label>
  </div>
</div>

  <hr>

  <label>Fuzzy Search by Account Label:</label>
  <div class="search-row">
    <input type="text" id="searchInput" placeholder="Search 'john bank', etc." oninput="handleSearch()" class="form-control">
    <button onclick="retrieveAll()">ðŸ“œ Retrieve All</button>
  </div>

  <div id="searchResults"></div>

  <!-- Textarea 1 -->
  <textarea id="allDecrypted" readonly></textarea>

  <div id="textarea1-buttons" style="display:none;">
    <button onclick="encryptTextareaContent()">ðŸ”’ Encrypt Textarea Content</button>
    <button onclick="copyTextareaContent('allDecrypted')">ðŸ“‹ Copy Textarea Content</button>
    <button onclick="saveTextareaContent('allDecrypted')">ðŸ’¾ Save Textarea Content</button>
  </div>

  <!-- Textarea 2 -->
  <textarea id="encryptedOutput" readonly style="display:none;"></textarea>

  <div id="textarea2-buttons" style="display:none;">
    <button onclick="copyTextareaContent('encryptedOutput')">ðŸ“‹ Copy Encrypted Content</button>
    <button onclick="saveTextareaContent('encryptedOutput')">ðŸ’¾ Save Encrypted Content</button>
  </div>

  <!-- Original JavaScript (unchanged) -->
<!-- âœ… Core CryptoJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<!-- âœ… Reuse all encryption/decryption from base.js -->
<script src="base.js"></script>

<script>
const HARDCODED_FALLBACK_LINK = "https://example.com/default.txt";
const ENCRYPTED_LINKS = {
  test: "U2FsdGVkX1/e1MQlF8ECQGTO7yTWEPhUgJy9frLZ4nF0DpYqjyggP8SR5fH8mWB9633XbVG6QV9dpNcbSjR68OAcW4xvu/S0345E1I8nL/zN7X49/+A4gkuAVGHK9pw3H8O9MNfV0De1GT7spsTjl69FqXo1M7V0J0fVL7KlLFt9+11beAje02UU09NDrz/Va2lfEPCR2ku5pBnLfDN04w==",
  paul: "U2FsdGVkX19oN2I7FJ6X/o8pbcMspFUyCz...",
  Ri: "U2FsdGVkX1+QPdYeNK30fa7wXdAQjLt6cNYrAJGtfCYoZBN8WA3I1Uruumv6DC78Uwl0K84lmoqTvA64EgBxrLcWCLv+9hI9iRUPKKze8/6IanqL4WpIBNS/4EVJ36UYVTwbXy9SsNB3/002eq+3u7JIKxLAH2sh7QYak4ErhqwO9wXJSOvRkhxPZm0/D3NR",
  As: "U2FsdGVkX1/fBml5AANzgsiGz55z0l+A5Bs48yUoi5QCvIa/UZkjqtw05aCFKw0CuL4PfjcxcL7HqOTCfBjYHPRZ2gJK6s+3L4DqhmdlaW3q+2gT9ax2ah1S52+RVBw9XieqiS1RTCr7O42IMJr6zwmBiD7JDWbhVlNKNpaRKrh3LYFnlsSPZVU89ZhzFZFdhztXdoO+qgR93OPobaG1NA==",
  mano: "U2FsdGVkX19VoivPdGfYddvYxGHUXWkX..."
};

let encryptedContent = '';
let decryptedBlocks = [];

// === File Loader ===
document.getElementById('fileInput').addEventListener('change', function() {
  const file = this.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    encryptedContent = e.target.result;
    showToast("File loaded successfully.", "success");
  };
  reader.readAsText(file);
});

// === Fetch helper ===
async function loadRemoteContent(url) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Network or CORS error.");
    return await res.text();
  } catch (err) {
    showToast("Failed to fetch file: " + err.message, "error");
    return null;
  }
}



// --- Reset all page content ---
function resetAll() {
  // Reset decrypted content and UI
  decryptedBlocks = [];
  document.getElementById('searchInput').value = '';
  document.getElementById('searchResults').innerHTML = '';
  document.getElementById('allDecrypted').value = '';
  document.getElementById('allDecrypted').style.display = 'none';
  document.getElementById('textarea1-buttons').style.display = 'none';
  document.getElementById('encryptedOutput').value = '';
  document.getElementById('encryptedOutput').style.display = 'none';
  document.getElementById('textarea2-buttons').style.display = 'none';

  // Reset file input
  const fileInput = document.getElementById('fileInput');
  fileInput.value = '';
  encryptedContent = '';

  // Reset link inputs
  document.getElementById('linkInput').value = '';
  document.getElementById('encryptedLinkSelector').value = '';

  // Reset password
  document.getElementById('aesPassword').value = '';

  // Reset Load button
  const loadBtn = document.getElementById('loadEncryptedBtn');
  loadBtn.style.backgroundColor = '#007bff';
  loadBtn.style.color = 'white';
  loadBtn.textContent = "ðŸ”“ Load Encrypted Data";
  loadBtn.disabled = false;

  // Hide Reset button
  const resetBtn = document.getElementById('resetBtn');
  resetBtn.style.display = 'none';
  
  document.getElementById('decomCheckbox').checked = false;
  document.getElementById('decomWrapper').style.display = 'none';
}






// === Fuzzy Search ===
function normalizeText(str) {
  return str.toLowerCase().replace(/[^a-z0-9 ]+/g,'').trim().split(/\s+/);
}

// === Load and Decrypt Encrypted Data ===
async function loadEncryptedData() {
  const rawPass = document.getElementById('aesPassword').value.trim();
  if (!rawPass) { showToast("Enter AES password.", "error"); return; }

  const loadBtn = document.getElementById('loadEncryptedBtn');
  const resetBtn = document.getElementById('resetBtn');

  let content = encryptedContent;

  const linkInputField = document.getElementById('linkInput');
  const linkInput = linkInputField.value.trim();
  const selector = document.getElementById('encryptedLinkSelector').value.trim();
  const fileInput = document.getElementById('fileInput');

  if (!content) {
    let finalLink = null;
    if (linkInput) {
      finalLink = linkInput;
    } else if (selector && ENCRYPTED_LINKS[selector]) {
      try {
        const decryptedLink = base.decryptText(ENCRYPTED_LINKS[selector], rawPass, true);
        if (!decryptedLink) throw new Error("Invalid password or link.");
        finalLink = decryptedLink;
      } catch {
        showToast("Invalid password or link.", "error");
        return;
      }
    } else {
      finalLink = HARDCODED_FALLBACK_LINK;
    }

    content = await loadRemoteContent(finalLink);
    if (!content) return;
  }

  try {
    decryptedBlocks = []; // clear previous

    const base64Matches = [...content.matchAll(/U2FsdGVkX1[\s\S]+?(?=U2FsdGVkX1|$)/g)];
    if (!base64Matches.length) { showToast("No valid Base64 blocks found.", "error"); return; }

    let blockCount = 0, entryCount = 0;

    for (const match of base64Matches) {
      const block = match[0].replace(/\s+/g, '');
      let dec = '';
      try { dec = base.decryptText(block, rawPass, true); if (!dec || !dec.trim()) continue; }
      catch { continue; }

      blockCount++;

      // Split each <ACTDET> into tags
      const actMatches = [...dec.matchAll(/<ACTDET>([\s\S]*?)<\/ACTDET>/gi)];
      actMatches.forEach(act => {
        const inner = act[1].trim();
        const tags = [...inner.matchAll(/<([^\/][^>]+)>([\s\S]*?)<\/\1>/g)];
        tags.forEach(tag => {
          decryptedBlocks.push({
            tagName: tag[1].trim().toLowerCase(),
            tagContent: tag[2].trim()
          });
          entryCount++;
        });
      });
    }

    if (!decryptedBlocks.length) {
      showToast("Decryption failed â€” no valid entries.", "error");
      return;
    }

    showToast(`Success: ${blockCount} Blocks and ${entryCount} entries`, "success");

    // Reset UI
    document.getElementById('searchInput').value = '';
    document.getElementById('searchResults').innerHTML = '';
    document.getElementById('allDecrypted').style.display = 'none';
    document.getElementById('allDecrypted').value = '';
    document.getElementById('textarea1-buttons').style.display = 'none';
    document.getElementById('encryptedOutput').style.display = 'none';
    document.getElementById('textarea2-buttons').style.display = 'none';

    // Clear inputs
    document.getElementById('aesPassword').value = '';
    linkInputField.value = '';
    document.getElementById('encryptedLinkSelector').value = '';
    fileInput.value = '';
    encryptedContent = '';

    // Load button success state
    loadBtn.style.backgroundColor = '#28a745';
    loadBtn.style.color = 'white';
    loadBtn.textContent = "âœ… Loaded";
    loadBtn.disabled = true;

    resetBtn.style.display = 'inline-block';
    document.getElementById('decomWrapper').style.display = 'inline-flex';

  } catch (err) {
    console.error("Decryption failed:", err);
    showToast("Decryption failed.", "error");
    decryptedBlocks = [];
    loadBtn.style.backgroundColor = '#007bff';
    loadBtn.style.color = 'white';
    loadBtn.textContent = "ðŸ”“ Load Encrypted Data";
    loadBtn.disabled = false;
    resetBtn.style.display = 'none';
  }
}

// === Fuzzy Search ===
function handleSearch() {
  const includeDecom = document.getElementById('decomCheckbox').checked;
  const qRaw = document.getElementById('searchInput').value.trim();
  const resultsDiv = document.getElementById('searchResults');
  resultsDiv.innerHTML = '';

  const area = document.getElementById('allDecrypted');
  area.style.display = 'none';
  area.value = '';
  document.getElementById('textarea1-buttons').style.display = 'none';

  const q = qRaw.toLowerCase().trim().split(/\s+/).filter(x => x);
  if (!q.length) return;

  decryptedBlocks.forEach(item => {
    // Skip decom blocks if checkbox off
    if (!includeDecom && /decom/i.test(item.tagContent)) return;

    const labelMatch = item.tagName === 'accountlabel' ? item.tagContent : '';
    if (q.length && labelMatch && !q.every(term => labelMatch.toLowerCase().includes(term))) return;

    const cont = document.createElement('div');
    cont.className = 'result-field';

    let field;
    if (item.tagName === 'password') {
      field = document.createElement('input');
      field.type = 'text';
      field.readOnly = true;
      field.value = '********';
      field.dataset.realValue = item.tagContent;
    } else if (item.tagName === 'freearea') {
      field = document.createElement('textarea');
      field.readOnly = true;
      field.value = item.tagContent;
      field.style.width = '100%';
      field.style.minHeight = '80px';
      field.style.resize = 'vertical';
      field.style.fontSize = '0.85rem';
      field.style.padding = '4px';
      field.style.borderRadius = '4px';
      field.style.border = '1px solid #ccc';
      field.style.backgroundColor = '#f8f9fa';
    } else {
      field = document.createElement('input');
      field.type = 'text';
      field.readOnly = true;
      field.value = item.tagContent;
    }

    const label = document.createElement('small');
    label.textContent = item.tagName + ':';
    label.style.fontWeight = '600';
    label.style.marginRight = '8px';
    label.style.flexShrink = '0';

    const btn = document.createElement('button');
    btn.className = 'btn btn-outline-secondary btn-sm';
    btn.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
    btn.onclick = () => {
      const copyText = field.dataset?.realValue || item.tagContent;
      navigator.clipboard.writeText(copyText);
      showToast("Copied to clipboard.", "success");
    };

    cont.appendChild(label);
    cont.appendChild(field);
    cont.appendChild(btn);
    resultsDiv.appendChild(cont);
  });
}

// === Retrieve All ===
function retrieveAll() {
  document.getElementById('searchInput').value = '';
  document.getElementById('searchResults').innerHTML = '';
  const resultsDiv = document.getElementById('searchResults');

  decryptedBlocks.forEach(item => {
    const cont = document.createElement('div');
    cont.className = 'result-field';

    let field;
    if (item.tagName === 'password') {
      field = document.createElement('input');
      field.type = 'text';
      field.readOnly = true;
      field.value = '********';
      field.dataset.realValue = item.tagContent;
    } else if (item.tagName === 'freearea') {
      field = document.createElement('textarea');
      field.readOnly = true;
      field.value = item.tagContent;
      field.style.width = '100%';
      field.style.minHeight = '80px';
      field.style.resize = 'vertical';
      field.style.fontSize = '0.85rem';
      field.style.padding = '4px';
      field.style.borderRadius = '4px';
      field.style.border = '1px solid #ccc';
      field.style.backgroundColor = '#f8f9fa';
    } else {
      field = document.createElement('input');
      field.type = 'text';
      field.readOnly = true;
      field.value = item.tagContent;
    }

    const label = document.createElement('small');
    label.textContent = item.tagName + ':';
    label.style.fontWeight = '600';
    label.style.marginRight = '8px';
    label.style.flexShrink = '0';

    const btn = document.createElement('button');
    btn.className = 'btn btn-outline-secondary btn-sm';
    btn.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
    btn.onclick = () => {
      const copyText = field.dataset?.realValue || item.tagContent;
      navigator.clipboard.writeText(copyText);
      showToast("Copied to clipboard.", "success");
    };

    cont.appendChild(label);
    cont.appendChild(field);
    cont.appendChild(btn);
    resultsDiv.appendChild(cont);
  });

  // Show the action buttons for "allDecrypted" textarea
  document.getElementById('allDecrypted').style.display = 'none';
  document.getElementById('textarea1-buttons').style.display = 'flex';
  document.getElementById('encryptedOutput').style.display = 'none';
  document.getElementById('textarea2-buttons').style.display = 'none';
}

  // hide old single textarea
  document.getElementById('allDecrypted').style.display = 'none';
  document.getElementById('allDecrypted').value = '';
  document.getElementById('textarea1-buttons').style.display = 'none';
  document.getElementById('encryptedOutput').style.display = 'none';
  document.getElementById('textarea2-buttons').style.display = 'none';
}

// === Encrypt textarea using base.js ===
function encryptTextareaContent() {
  const pwdRaw = document.getElementById('aesPassword').value.trim();
  if (!pwdRaw) { alert("Enter AES password to encrypt."); return; }
  const plainText = document.getElementById('allDecrypted').value;
  if (!plainText) { alert("Textarea is empty."); return; }
  try {
    const encrypted = base.encryptText(plainText, pwdRaw, true);
    const encArea = document.getElementById('encryptedOutput');
    encArea.value = encrypted;
    encArea.style.display = 'block';
    document.getElementById('textarea2-buttons').style.display = 'flex';
  } catch {
    alert("Encryption failed.");
  }
}

// === Copy and Save utilities ===
function copyTextareaContent(id) {
  const area = document.getElementById(id);
  if (!area.value) { alert("Nothing to copy."); return; }
  navigator.clipboard.writeText(area.value).then(() => alert("Copied."))
    .catch(() => alert("Copy failed."));
}

function saveTextareaContent(id) {
  const area = document.getElementById(id);
  if (!area.value) { alert("Nothing to save."); return; }
  const blob = new Blob([area.value], {type: "text/plain"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = id === 'allDecrypted' ? 'decrypted.txt' : 'encrypted.txt';
  document.body.appendChild(a);
  a.click();
  setTimeout(() => {
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 0);
}

// Trigger load button on Enter key in AES password field
document.getElementById('aesPassword').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault(); // prevent form submission / line break
    document.getElementById('loadEncryptedBtn').click();
  }
});


</script>






<div id="toastContainer"></div>

</body>
</html>
