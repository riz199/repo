<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Text Encryptor/Decryptor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Retriever Theme */
    body {
      font-family: 'Inter', Arial, sans-serif;
      background-color: #f9fafb;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
    }

    label {
      font-weight: 500;
      margin-top: 10px;
    }

    textarea, input[type="password"], input[type="file"] {
      width: 100%;
      margin: 10px 0;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.95rem;
      box-sizing: border-box;
    }

    button {
      height: 42px;
      font-size: 0.95rem;
      padding: 0 15px;
      border-radius: 6px;
      border: none;
      background-color: #007bff;
      color: white;
      transition: background-color 0.2s ease-in-out;
      white-space: nowrap;
    }

    button:hover {
      background-color: #0056b3;
    }

    button:active {
      background-color: #004a99;
    }

    /* Layout alignment */
    .btn-group-custom {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    /* Ensure text fits even on smallest screens */
    @media (max-width: 420px) {
      button {
        font-size: 0.8rem;
        padding: 0 10px;
        height: 40px;
      }

      textarea {
        font-size: 0.85rem;
      }
    }

    @media (max-width: 340px) {
      button {
        font-size: 0.75rem;
        height: 38px;
      }
    }
  </style>
</head>

<body>
  <h2>üîê AES Text Encryptor / Decryptor</h2>

  <label>Upload .txt File:</label>
  <input type="file" id="fileInput" accept=".txt"><br>

  <label>Original Text:</label>
  <textarea id="originalText" rows="10" placeholder="File content here..."></textarea>

  <label>Password:</label>
  <input type="password" id="password" placeholder="Enter password">

  <div class="btn-group-custom">
    <button onclick="encryptText()">Encrypt</button>
    <button onclick="decryptText()">Decrypt</button>
  </div>

  <label>Result:</label>
  <textarea id="resultText" rows="10" placeholder="Encrypted/Decrypted text..."></textarea><br>

  <div class="btn-group-custom">
    <button onclick="saveFile()">üíæ Save Result</button>
    <button onclick="copyResult()">üìã Copy Result</button>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const originalText = document.getElementById('originalText');
    const resultText = document.getElementById('resultText');
    const password = document.getElementById('password');

    const PREFIX = "!@#$%^&*()_+ÍôÆ‚Ç™ÿã‚Ç©‡∏ø‚Ç∫‡ß≥‚∏ò‚ç∞‚åò‚èö‚ß´üÇ°üù∞üúö";
    const SUFFIX = "+_)(*&^%$ÍôÆ‚Ç™ÿã‚Ç©‡∏ø‚Ç∫‡ß≥‚∏ò‚ç∞‚åò‚èö‚ß´üÇ°üù∞üúö";

    // Read uploaded file
    fileInput.addEventListener('change', function () {
      const file = fileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          originalText.value = e.target.result;
        };
        reader.readAsText(file);
      }
    });

    function encryptText() {
      const text = originalText.value;
      const pass = password.value;
      if (!text || !pass) return alert("Please enter both text and password.");

      const finalPassword = PREFIX + pass + SUFFIX;
      const encrypted = CryptoJS.AES.encrypt(text, finalPassword).toString();
      resultText.value = encrypted;
    }

    function decryptText() {
      const encryptedText = originalText.value.trim();
      const pass = password.value;
      if (!encryptedText || !pass) return alert("Please enter both encrypted text and password.");

      const finalPassword = PREFIX + pass + SUFFIX;

      try {
        const lines = encryptedText.split('\n').filter(line => line.trim() !== '');
        const decryptedLines = lines.map(line => {
          const bytes = CryptoJS.AES.decrypt(line.trim(), finalPassword);
          const decrypted = bytes.toString(CryptoJS.enc.Utf8);
          if (!decrypted) throw new Error("Decryption failed for a line");
          return decrypted;
        });
        resultText.value = decryptedLines.join('\n');
      } catch (e) {
        alert("Invalid password or corrupted data.");
      }
    }

    function saveFile() {
      const blob = new Blob([resultText.value], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "output.txt";
      link.click();
    }

    function copyResult() {
      const text = resultText.value;
      if (!text) return alert("Nothing to copy.");
      navigator.clipboard.writeText(text)
        .then(() => alert("Result copied to clipboard!"))
        .catch(() => alert("Copy failed."));
    }
  </script>
</body>
</html>
